<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petworld</title>
    <link rel="stylesheet" href="css/veterinarias.css">
    <link rel="icon"  href="img/Capa_1.png">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }

        .map-modal {
            width: 90%;
            max-width: 800px;
        }
    </style>
</head>
<body>

    <!-- Header Section -->
    <header>
        <div class="search-bar">
            <a href="MenuInicio.html">  <img src="Img/Capa_1.png" alt="Logo Gato" class="logo"> </a>
            <input type="text" id="searchInput" placeholder="Buscar">
        </div>
    </header>

    <!-- Categories Section -->
    <nav class="nav-bar">
        <div class="nav-item">
             <img src="Img/Veterinarias.png" alt="Veterinaria">
             <p>Veterinaria</p>
         </div>
   
        <a href="Perdido.html" style="text-decoration: none; color: #000;"> <div class="nav-item">
             <img src="Img/mascota_perdida.png" alt="Mascotas Perdidas">
             <p>Mascotas Perdidas</p>
         </div>
     </a>
        <a href="Articulos.html" style="text-decoration: none; color: #000;"> <div class="nav-item">
             <img src="Img/Accesorios.png" alt="Accesorios">
             <p>Accesorios</p>
         </div>
     </a>
       <a href="Tienda.html" style="text-decoration: none; color: #000;">  <div class="nav-item">
             <img src="Img/servicios.png" alt="Servicios de Cuidado">
             <p>Servicios de Cuidados</p>
         </div>
     </a>
     </nav>  

    <!-- Veterinary Hospital List Section -->
    <section class="hospital-list">
        <div class="hospital">
            <div class="hospital-img" style="background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 240px;">
                <h2 style="color: #666;">Dr. Pet</h2>
            </div>
            <div class="hospital-info">
                <h3>Clínica Veterinaria Dr. Pet</h3>
                <p>Lunes a sábado: 7:00 AM - 7:00 PM</p>
                <p>Domingo: 8:00 AM - 2:00 PM</p>
                <a href="https://maps.app.goo.gl/LGvHBGKQKGHyPTqv7" class="address" target="_blank">Dirección</a>
                <p>Calle 16 #12-46, Centro, Valledupar</p>
                <div class="status-container">
                    <span class="status">Verificando...</span>
                    <span class="rating">⭐ 4.8/5</span>
                </div>
                <button class="route-link" data-lat="10.4634" data-lng="-73.2532">Mostrar ruta</button>
            </div>
        </div>

        <div class="hospital">
            <div class="hospital-img" style="background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 240px;">
                <h2 style="color: #666;">Animal Health</h2>
            </div>
            <div class="hospital-info">
                <h3>Centro Veterinario Animal Health</h3>
                <p>Lunes a viernes: 8:00 AM - 6:00 PM</p>
                <p>Sábado: 8:00 AM - 2:00 PM</p>
                <a href="https://maps.app.goo.gl/wHHHrYQEFPTBGgqb8" class="address" target="_blank">Dirección</a>
                <p>Calle 44 #19-46, Valledupar</p>
                <div class="status-container">
                    <span class="status">Verificando...</span>
                    <span class="rating">⭐ 4.5/5</span>
                </div>
                <button class="route-link" data-lat="10.4634" data-lng="-73.2532">Mostrar ruta</button>
            </div>
        </div>

        <div class="hospital">
            <div class="hospital-img" style="background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 240px;">
                <h2 style="color: #666;">San Francisco</h2>
            </div>
            <div class="hospital-info">
                <h3>Veterinaria San Francisco</h3>
                <p>Lunes a sábado: 8:00 AM - 7:00 PM</p>
                <a href="https://maps.app.goo.gl/sSXjGFBFQPBGPxJR7" class="address" target="_blank">Dirección</a>
                <p>Cra. 7 #16A-63, Valledupar</p>
                <div class="status-container">
                    <span class="status">Verificando...</span>
                    <span class="rating">⭐ 4.7/5</span>
                </div>
                <button class="route-link" data-lat="10.4634" data-lng="-73.2532">Mostrar ruta</button>
            </div>
        </div>

        <div class="hospital">
            <div class="hospital-img" style="background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 240px;">
                <h2 style="color: #666;">Cesar</h2>
            </div>
            <div class="hospital-info">
                <h3>Centro Veterinario Cesar</h3>
                <p>Lunes a viernes: 7:30 AM - 6:30 PM</p>
                <p>Sábado: 8:00 AM - 2:00 PM</p>
                <a href="https://maps.app.goo.gl/sSXjGFBFQPBGPxJR7" class="address" target="_blank">Dirección</a>
                <p>Calle 16C #19B-50, Valledupar</p>
                <div class="status-container">
                    <span class="status">Verificando...</span>
                    <span class="rating">⭐ 4.6/5</span>
                </div>
                <button class="route-link" data-lat="10.4634" data-lng="-73.2532">Mostrar ruta</button>
            </div>
        </div>

        <div class="hospital">
            <div class="hospital-img" style="background-color: #f0f0f0; display: flex; justify-content: center; align-items: center; height: 240px;">
                <h2 style="color: #666;">Mascoticas</h2>
            </div>
            <div class="hospital-info">
                <h3>Clínica Veterinaria Mascoticas</h3>
                <p>Lunes a sábado: 8:00 AM - 6:00 PM</p>
                <a href="https://maps.app.goo.gl/sSXjGFBFQPBGPxJR7" class="address" target="_blank">Dirección</a>
                <p>Cra. 19 #7A-32, Valledupar</p>
                <div class="status-container">
                    <span class="status">Verificando...</span>
                    <span class="rating">⭐ 4.4/5</span>
                </div>
                <button class="route-link" data-lat="10.4634" data-lng="-73.2532">Mostrar ruta</button>
            </div>
        </div>

        <!-- Agregar más veterinarias según sea necesario -->
    </section>

    <!-- Bottom Navigation Bar -->
    <footer class="footer">
        <div class="footer-item">
            <img src="Img/home.png" alt="Inicio">
        </div>
        <div class="footer-item">
            <img src="Img/calendario (1).png" alt="Calendario">
        </div>
        <div class="footer-item">
            <img src="Img/recordatorio.png" alt="Publicaciones">
        </div>
        <div class="footer-item">
            <img src="Img/campana (1).png" alt="Notificaciones">
        </div>
        <div class="footer-item">
            <button class="toggle-sidebar"><img src="Img/Union.png" alt="Perfil"></button>
        </div>
    </footer>
    <nav class="sidebar">
        <div class="sidebar-profile" style="display: flex; align-items: center;">
            <a href="Perfil.html"> <img id="userProfilePic" class="user-pic, sidebar-profile-pic" src="img/default-profile.jpg"alt="Foto de perfil"> </a>
            <h2 id="userName">Nombre de Usuario</h2>
        </div>

        <div style="display: flex; flex-direction: column; padding-top: 300%;">
            <a href="" style="margin-bottom: 10px; text-decoration: none; color: #000;">Guardado</a>

            <a href="" style="margin-bottom: 10px; text-decoration: none; color: #000;">Agenda</a>

            <a href="" style="margin-bottom: 10px; text-decoration: none; color: #000;">Adoptar</a>

            <a href="" style="margin-bottom: 10px; text-decoration: none; color: #000;">Servicio funenaria</a>

            <a href="" style="margin-bottom: 10px; text-decoration: none; color: #000;">Aprende primeros  auxilios</a>

            <a href="" style="margin-bottom: 10px; text-decoration: none; color: #000;">Ayuda y soporte</a>

            <a href="" style="margin-bottom: 10px; text-decoration: none; color: #000;">Configuracion y privacidad</a>

            <button id="logoutButton" style="background: none; border: none; margin-right: 100px; cursor: pointer; color: #000;"> <p style="font-size: 18px;">Cerrar sesión</p></button>            <div id="myModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>¿Seguro que quieres cerrar sesión?</h2>
                    <button id="confirmLogout">ACEPTAR</button>
                    <button id="cancelLogout">RECHAZAR</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Agregar antes del cierre del body -->
    <div id="mapModal" class="modal">
        <div class="modal-content map-modal">
            <span class="close-map">&times;</span>
            <div id="map"></div>
        </div>
    </div>
</body>
<script src="js/side-bar.js"></script>
<script src="js/emergente.js"></script>
<script src="js/search.js"></script>
<script src="js/firebaseRE.js"></script>
<script src="js/auth.js"></script>
<script>
let map;
let userMarker;
const mapModal = document.getElementById('mapModal');
const closeMapBtn = document.querySelector('.close-map');

// Coordenadas de las veterinarias
const veterinarias = {
    'Clínica Veterinaria Dr. Pet': {lat: 10.4634, lng: -73.2532},
    'Centro Veterinario Animal Health': {lat: 10.4697, lng: -73.2432},
    'Veterinaria San Francisco': {lat: 10.4623, lng: -73.2498},
    'Centro Veterinario Cesar': {lat: 10.4701, lng: -73.2467},
    'Clínica Veterinaria Mascoticas': {lat: 10.4589, lng: -73.2511}
};

// Inicializar el mapa con la ruta
function initMap(destLat, destLng) {
    if (map) {
        map.remove(); // Limpiar el mapa existente
    }
    
    map = L.map('map');
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);

    // Obtener la ubicación actual del usuario
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(function(position) {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;

            // Crear marcador para la ubicación del usuario
            userMarker = L.marker([userLat, userLng])
                .bindPopup('Tu ubicación actual')
                .addTo(map);

            // Crear marcador para la veterinaria
            const vetMarker = L.marker([destLat, destLng])
                .bindPopup('Veterinaria')
                .addTo(map);

            // Crear una línea entre los dos puntos
            const routeLine = L.polyline(
                [[userLat, userLng], [destLat, destLng]],
                {
                    color: '#FF0000',
                    weight: 3,
                    opacity: 0.7,
                    dashArray: '10, 10'
                }
            ).addTo(map);

            // Ajustar el zoom para mostrar toda la ruta
            const bounds = L.latLngBounds([
                [userLat, userLng],
                [destLat, destLng]
            ]);
            map.fitBounds(bounds, { padding: [50, 50] });

            // Calcular distancia aproximada
            const distance = calculateDistance(userLat, userLng, destLat, destLng);
            L.popup()
                .setLatLng([(userLat + destLat)/2, (userLng + destLng)/2])
                .setContent(`Distancia aproximada: ${distance.toFixed(2)} km`)
                .openOn(map);

        }, function(error) {
            console.error("Error obteniendo la ubicación:", error);
            map.setView([destLat, destLng], 15);
            L.marker([destLat, destLng]).addTo(map);
        });
    } else {
        alert("Tu navegador no soporta geolocalización");
        map.setView([destLat, destLng], 15);
        L.marker([destLat, destLng]).addTo(map);
    }
}

// Función para calcular la distancia entre dos puntos
function calculateDistance(lat1, lon1, lat2, lon2) {
    const R = 6371; // Radio de la Tierra en km
    const dLat = toRad(lat2 - lat1);
    const dLon = toRad(lon2 - lon1);
    const a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) * 
        Math.sin(dLon/2) * Math.sin(dLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
}

function toRad(degrees) {
    return degrees * (Math.PI/180);
}

// Configurar los botones de ruta
document.querySelectorAll('.route-link').forEach(button => {
    button.addEventListener('click', (e) => {
        e.preventDefault();
        const hospitalName = e.target.closest('.hospital-info').querySelector('h3').textContent;
        const coords = veterinarias[hospitalName];
        
        mapModal.style.display = 'block';
        initMap(coords.lat, coords.lng);
    });
});

// Cerrar el modal
closeMapBtn.onclick = () => {
    mapModal.style.display = 'none';
}

window.onclick = (e) => {
    if (e.target == mapModal) {
        mapModal.style.display = 'none';
    }
}

// Función para verificar si la veterinaria está abierta
function checkIfOpen(schedule) {
    const now = new Date();
    const day = now.getDay(); // 0 = domingo, 1 = lunes, etc.
    const time = now.getHours() * 100 + now.getMinutes(); // formato 24hrs en HHMM

    const schedules = {
        'Clínica Veterinaria Dr. Pet': {
            1: { open: 700, close: 1900 },  // Lunes
            2: { open: 700, close: 1900 },  // Martes
            3: { open: 700, close: 1900 },  // Miércoles
            4: { open: 700, close: 1900 },  // Jueves
            5: { open: 700, close: 1900 },  // Viernes
            6: { open: 700, close: 1900 },  // Sábado
            0: { open: 800, close: 1400 }   // Domingo
        },
        'Centro Veterinario Animal Health': {
            1: { open: 800, close: 1800 },
            2: { open: 800, close: 1800 },
            3: { open: 800, close: 1800 },
            4: { open: 800, close: 1800 },
            5: { open: 800, close: 1800 },
            6: { open: 800, close: 1400 }
        },
        'Veterinaria San Francisco': {
            1: { open: 800, close: 1900 },
            2: { open: 800, close: 1900 },
            3: { open: 800, close: 1900 },
            4: { open: 800, close: 1900 },
            5: { open: 800, close: 1900 },
            6: { open: 800, close: 1900 }
        },
        'Centro Veterinario Cesar': {
            1: { open: 730, close: 1830 },
            2: { open: 730, close: 1830 },
            3: { open: 730, close: 1830 },
            4: { open: 730, close: 1830 },
            5: { open: 730, close: 1830 },
            6: { open: 800, close: 1400 }
        },
        'Clínica Veterinaria Mascoticas': {
            1: { open: 800, close: 1800 },
            2: { open: 800, close: 1800 },
            3: { open: 800, close: 1800 },
            4: { open: 800, close: 1800 },
            5: { open: 800, close: 1800 },
            6: { open: 800, close: 1800 }
        }
    };

    const hospitalSchedule = schedules[schedule];
    if (!hospitalSchedule || !hospitalSchedule[day]) {
        return false; // Cerrado los días no especificados
    }

    const { open, close } = hospitalSchedule[day];
    return time >= open && time < close;
}

// Actualizar el estado de todas las veterinarias
function updateAllStatuses() {
    document.querySelectorAll('.hospital').forEach(hospital => {
        const hospitalName = hospital.querySelector('h3').textContent;
        const statusElement = hospital.querySelector('.status');
        
        if (checkIfOpen(hospitalName)) {
            statusElement.textContent = 'Abierto';
            statusElement.style.color = '#4CAF50';
        } else {
            statusElement.textContent = 'Cerrado';
            statusElement.style.color = '#f44336';
        }
    });
}

// Actualizar estados cada minuto
updateAllStatuses();
setInterval(updateAllStatuses, 60000);
</script>
</html>
